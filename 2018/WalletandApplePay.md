# WWDC스터디 5주차 23.04.02

# Wallet and Apple Pay: Creating Great Customer Experiences(WWDC2018)


## Apple Pay Cash
- 아이메세지를 이용해서 가족과 친구간에 지불할 수 있다.
- 미국에서만 됨
- 괜히 봄 이부분은

## Inline Setup
- 애플페이 카드가 없는 사용자가 카드를 설정한 다음 한번에 구매로 돌아갈 수 있음
- SetUp ApplePay버튼을 표시하기만 하면 됩니다.

| 애플페이가 없는 사용자가 보는화면 | 애플페이 설정화면 | 바로 구매로 돌아감 |
| -------- | -------- | -------- |
| <img src="https://i.imgur.com/L7gZFJy.png">     | <img src="https://i.imgur.com/UiMy9vf.png">     | <img src="https://i.imgur.com/dxrqml7.png">     |

- SMS를 통해서도 설정이 가능함
- 더 빠른 체크아웃을 돕기위해 에러 핸들링 도입
    - 이를 통해 Apple Pay Sheet에서 치명적이지 않은 오류를 제어할 수 있습니다. 
    - 청구 및 배송문제에 대한 사용자 지정 오류메세지를 보낼 수도 있습니다.

### Error Handling Tips
- 퍼지데이터를 기대한다
- 사용자는 애플페이에 하나의 데이터 세트를 갖고 여러 앱과 웹사이트에서 공유된다.
- 사용자가 각 비즈니스의 로직을 따르도록 강요하는 것을 원하지 않는다. 그럼 정보를 다시 입력해야 하기 때문에 불편하고 애플페이를 사용하지 않을 것이다.
- 대신에 다양한 입력을 받게 한다. 그것이 우편번호? Zip+4이다.
- 우편번호에서 국가와 주 등의 정보를 받아올 수 있습니다.

여기까지 작년에 발표 됐던 내용임

## 애플페이를 개선 하는 방법

### Easier with Upsteraming
구매 버튼이 바로 있으면 제일 좋지만 다양한 결제 방법을 지원할 때는 좋지 못한 경험을 줄 수가 있기 때문에 장바구니에서 결제시 애플페이로 결제할 수 있는 버튼을 넣어 줄 수 있습니다.

### Apple Pay Button
모든 장치에서 언어가 현지화 되어 있다
지원되는 모든 장치에서 확장되며 변경사항이 있으면 향후 무료로 사용할 수 있다.
다양한 색상과 모양을 지원한다.
하지만 이 버튼이 항상 우리의 모든 요구사항에 맞지는 않는다.

### 1. 애플페이로 예약하기
![](https://i.imgur.com/zG4bb9Y.png)
- 호텔 예약이나 차량 공유서비스를 이용할때는 이 버튼을 사용해야 한다.

### 2. 애플페이로 구독하기
![](https://i.imgur.com/TF6m7qH.png)
- 구독 기반 구매에 사용해라
- 구독 정보를 전달한다.

### 3. 애플페이로 채크하기
![](https://i.imgur.com/ZckPuDJ.png)
- 동일한 페이지에서 결제에 대한 여러 참조가 있는 경우에 적합하다.
- 이것은 어떤 체크아웃이 실제로 애플페이를 실행할지 알 수 있습니다.

```swift
button.cornerRadius = 0 
//등을 사용해서 버튼의 모서리 모양을 바꿀 수 있다.
```

iOS12부터 사용가능하다.

위의 새로운 API를 사용하면 고객이 이전보다 더 쉽고 명확하게 구매할 수 있게된다.

#### Guest Checkout
> 이것을 사용자의 첫번째 경험으로 생각해야 한다.

처음 구매를 차단하면 마찰이 증가하여 포기로 이어질 수 있다.
사용자가 강제가 아닌 계정을 함께 만들고 싶어해야 한다.

애플페이는 이를 위한 방법을 또 제공하네요

구매 후 애플페이 시트의 데이터를 사용하여 계정 생성을 쉽게 할 수 있다.

애플페이 거래에서 사용자의 이메일 주소가 사용되었고 사용자는 계정 생성을 확인하기 위해 암호를 입력하기만 하면된다.

암호 자동완성을 함께 하면 더 쉽게 만들 수 있다. 

여기까지가 업스트림을 위한 전부이다.

### Faster with Defaulting(애플페이를 더 빠르게 하기 위한 기본 셋팅)
- 애플페이를 기본옵션으로 설정하여 더 빠르게한다.
- 사용자의 최신 고객 정보를 가지고 있기 때문에 훌륭하다.
<img src = "https://i.imgur.com/uAWzMg0.png" width = 300>

### Clearer with Streamlining

- 애플페이는 사용자의 정보를 선호한다. 이 정보를 사용자 경험에 유용하게 사용할 수 있다.
- 애플페이가 지원하지 않는 데이터가 필요하면 결제 전에 데이터를 수집해야한다.
    - 예를 들어 특정 제품의 항목 수 또는 바우처 코드

크게 두가지를 변경했다. 

첫째. zero tatal support? 총합계가 0원일때 지원하는 법

 ![](https://i.imgur.com/94uJ1Y7.png)
이게 원래 안됐었다고 합니다 
이젠 된데요 ㅎㅎ

첫달무료 구독같은거도 명확하게 명시 해 줄 수 있다.
- ios12에서 부터 
- 향후 웹킷에 제공됨

둘째로 세가지 네트워크 추가
비자 마에스트로 Vpay 이때부터 지원함

Apple Pay JS API or Payment Request API
![](https://i.imgur.com/QHNuEdo.png)

- 애플페이는 사파리에서만 지원됨
- 애플페이 API로 하면 오류 핸드링이 가능하고 지원하는 브랜드의 카드를도 선택한다.
- 결제 요청 API를 만약 선택하면 Apple Pay JaveScript API를 이전 클라이언트의 폴백으로 사용하는 것이 좋다

### 데모페이지
데모페이지에서 애플페이 버튼을 만들어 보는 것 부터 json데이터를 만들어보는것 까지 해볼 수 있다.


## Getting the Mose from passes
pass를 다루는 법에 자세히 알아보자.
pass를 왜 사용하나?

<img src = "https://i.imgur.com/dpJkFJU.jpg" width=300>
(요런게 패스)

- 비접촉식 또는 바코드로 사용하기 쉽다, iColoud를 통해서 모든 기기에서 동기화된다.
- 빠른 액세스를 위해 잠금화면과 검색에 지능적으로 표시할 수 있다.

### 첫째 지갑에 패스를 추가하는 방법
> 거의 모든 상황에서 자동 패스 추가 API를 사용하는 것이 좋다.
<img src = "https://i.imgur.com/MPVElWO.png" width = 500>

이것을 사용하려면 추가하려는 패스 배열과 PKPassLibrary에서 addPasses함수를 호출하기만 하면된다.

완료시 해당 뷰컨트롤러를 제공해야 한다.

패스를 추가하는 최고의 방법
- 지원되지 않는 플랫폼에서 오는 경우 사용자가 처음으로 앱에 들어갈때 외부에서 생성된 패스를 추가하는 것이 좋다.
- 그리고 마찰을 줄이기 위해 지갑앱의 그룹에 관련 패스를 추가해야 한다.
- 그리고 동일한 뷰에서 사용자가 지갑앱에 이미 패스가 있는 경우 패스에 직접 연결해야 한다.

### 둘째 패스를 보기 좋게 만든다.
- 첫째, 가장 중요한 정보는 사용자에게 표시하는 패스필드에 관련된 중요 정보가 있어야 한다는 것이다.
- 생생한 색상
- 멋지게 보이는 패스를 디자인해야한다. 재생산 x
- 몇가지 템플릿과 이런 필드를 눈에 띄게 만드는 레이아웃 옵션이 있다.

- 둘째, 여기에서 볼 수 있는 스트립 이미지 내부에 사용자 정보를 인코딩 하지마라.
- 애플워치에서 특히 중요하다 공간이 작기때문이다.
 ![](https://i.imgur.com/27Osz3J.png)

- 추가 행지원을 추가하여 작업을 조금 더 쉽게 만들고자 한다.

![](https://i.imgur.com/c4XUuhe.png)
- json파일을 만들때 Row를 구분해서 만들어줘야 함을 알 수 있다.
- Row는 보조 필드에서만 사용가능하고 이벤트 티켓 유형 패스에만 사용할 수 있다.
- 0,1만 가능하고 이전버전에서는 무시됨
- 행당 최대 4개 필드까지 한행에 표시된다

### 셋째 풍부한 패스 콘텐츠
관련성이 있는 정보를 제공하여 패스를 풍부하게 할 수 있다.

위치, relatedText및 relatedDate를 전달 Json필드를 설정하여 관련성을 추가 할 수 있습니다.

그리고 이것을 통해 시스템은 적이세 사용자에게 패스를 제시할 수 있다.
여러 일정의 패스를 설정할 경우 각각의 패스에 따로 설정을 해서 시스템이 사용자에게 한번에 하나씩 올바르게 표시할 수 있도록 해야 한다.

> Semeantic Tags
- JSON에서 이전에 보여준 필드는 표시를 위한 훌륭한 메커니즘이다. 그러나 iOS가 모든 필드에 대해 추론하기 어렵다는 것을 의미한다.
- 고유한키와 레이블 이름을 사용하기 때문이다.


- 시멘틱 태그는 고정형식 데이터로 디스플레이 데이터를 보강할 수 있는 구조화된 방법을 제공한다.


![](https://i.imgur.com/dicGWoN.png)
![](https://i.imgur.com/fEzKTbJ.png)

시멘틱 태그를 추가하여 관련성 있는 키이름을 가질 수 있다.
![](https://i.imgur.com/7onkXfF.png)
침묵요청을 true로 하고 초단위로 시간을 설정해주면 시리가 적시에 방해금지 모드를 활성화 시킬 수 있다.

영화티켓등의 이벤트 티켓에 좋다.

요약하면 시맨틱 태그는 기계가 읽을 수 있는 콘텐츠를 패스에 추가할 수 있는 좋은 방법이다.
이것에 관련된 모든 키는 [온라인 설명서](https://developer.apple.com/documentation/passkit/wallet/supporting_semantic_tags_in_wallet_passes)를 통해 확인할 수 있다.

### 마지막으로 비접촉식 패스
> 바코드 스캔보다 훨씬 향상된 경험이다

#### 비접촉식 패스를 시작하려면 NFC인증서가 필요하다
NFC를 사용해야 할일이 있다면 업체에 먼저 문의해야 하고 이 비 접촉식 판독기가 애플의 부가가치 서비스 프로토콜을 지원해야 한다.


## 데모앱 설명
<img src = "https://i.imgur.com/7q79gZW.png" width=300>
- 이벤트, 날짜, 시간, 위치, 및 비용에 대한 요약이 표시됨
- 애플페이로 구매 버튼이 제품페이지에 직접 배치하는 업스트림의 예이다.
![](https://i.imgur.com/TAWssJV.png)
- 구매후에 패스를 지갑앱에 추가하기 버튼을 함께 넣어줄 수 있다.
- 그럼 패스가 바로 추가된다.
- 비 접촉식으로 진행하기 때문에 바코드를 만드는 JSON을 할 필요가 없다. 대신 NFC를 추가한다.
![](https://i.imgur.com/njKdQ0J.png)
- 여기에는 체크인시 식별을 위해 판독기로 전달할 정보가 포함되어 있다.
 ![](https://i.imgur.com/nNLpiRd.png)
 
 
- 위치 및 잠금화면의 알림에 표시될 관련 텍스트를 설정할 수 있다.
- 
![](https://i.imgur.com/Lz7iqwa.jpg)

패스를 자동으로 추가할때 사용하는 메서드

PKPassesStatus에 있다.
월렛에 추가할지 결정하기 전에 미리보기를 제공한다.

- 사용자 경험을 향상시키기 위해 티켓 구매 직후 월렛에 패스를 추가할 것인지 즉시 묻는 것이다.


![](https://i.imgur.com/P70i84i.png)

- 이렇게 하면 사용자가 이버튼을 탭하여 지갑앱으로 바로 이동하고 방금 추가한 패스가 표시된다.
- 그리고 마지막으로 뷰가 표시되면 패스를 추가할건지 즉시 물어본다.
![](https://i.imgur.com/nOAVLRk.png)
이모양이었는데 원래
![](https://i.imgur.com/aOXbRtL.png)
이렇게 바꼈다

![](https://i.imgur.com/wShavnl.png)

이 패스가 비접촉식이며 이벤트에 도착하면 리더기를 통해 스캔할 수 있다는 것을 뜻함


## Digital to Physical Commerce
- 애플페이가 좋은 구매방법이지만 사용자의 여정이 끝나는 곳은 아니다.

## 마지막으로 확인해야 할 부분
![](https://i.imgur.com/7VJ7GMs.png)

- 서버 측 인증서 만료날짜를 확인해야 한다.
- 애플페이 사용 중단을 방지하려면 만료전에 갱신해야 한다.

Wallet Apple Pay and Core NFC Lab
에서 추가정보 얻으세요 이거 다음주 ..ㅎㅎ
